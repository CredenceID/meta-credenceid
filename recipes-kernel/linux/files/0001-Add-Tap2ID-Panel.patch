From 41a5111c21182e9d3202caf658e63520d9c4e868 Mon Sep 17 00:00:00 2001
From: Pavan Nittala <Pavan.Nittala@credenceid.com>
Date: Thu, 23 Jan 2025 08:50:46 +0000
Subject: [PATCH] Add Tap2ID Panel

---
 arch/arm64/boot/dts/freescale/imx8mm-c2.dts | 10 +++
 arch/arm64/boot/dts/panel-afr480360a0.dtsi  | 89 +++++++++++++++++++++
 2 files changed, 99 insertions(+)
 create mode 100644 arch/arm64/boot/dts/panel-afr480360a0.dtsi

diff --git a/arch/arm64/boot/dts/freescale/imx8mm-c2.dts b/arch/arm64/boot/dts/freescale/imx8mm-c2.dts
index a9a0a6b2ab04..44d3e7e57f72 100644
--- a/arch/arm64/boot/dts/freescale/imx8mm-c2.dts
+++ b/arch/arm64/boot/dts/freescale/imx8mm-c2.dts
@@ -23,11 +23,13 @@
 #include "panel-dlc0350gev06.dtsi"
 #include "panel-ltk080a60a004t.dtsi"
 #include "panel-m101nwwb.dtsi"
+#include "panel-afr480360a0.dtsi"
 #else
 #include "../bd-universal.h"
 #include "../panel-dlc0350gev06.dtsi"
 #include "../panel-ltk080a60a004t.dtsi"
 #include "../panel-m101nwwb.dtsi"
+#include "../panel-afr480360a0.dtsi"
 #endif
 
 &iomuxc {
@@ -222,6 +224,14 @@ MX8MMN(IOMUXC_SD2_CLK_GPIO2_IO13, 0x109)
 			MX8MMN(IOMUXC_SAI5_RXD3_GPIO3_IO24, 0x109)
 		>;
 	};
+	
+	pinctrl_mipi_afr480360a0: mipi-afr480360a0  {
+                fsl,pins = <
+/* Reset pin used as enable */
+#define GP_AFR480_ENABLE       <&gpio1 3 GPIO_ACTIVE_HIGH>
+                        MX8MMN(IOMUXC_GPIO1_IO03_GPIO1_IO3, 0x116)
+                >;
+        };
 
 	pinctrl_pwm2: pwm2grp {
 		fsl,pins = <
diff --git a/arch/arm64/boot/dts/panel-afr480360a0.dtsi b/arch/arm64/boot/dts/panel-afr480360a0.dtsi
new file mode 100644
index 000000000000..1310891fbdf8
--- /dev/null
+++ b/arch/arm64/boot/dts/panel-afr480360a0.dtsi
@@ -0,0 +1,89 @@
+#include <dt-bindings/display/simple_panel_mipi_cmds.h>
+
+#define PAGE(page) DCS_L3P(0xff, 0x98, 0x81, page)
+
+/ {
+	aliases {
+		mipi_cmds_afr480360a0 = &mipi_cmds_afr480360a0;
+		pinctrl_afr480360a0 = &pinctrl_mipi_afr480360a0;
+	};
+
+	mipi_cmds_afr480360a0: mipi-cmds-afr480360a0 {
+		alias = <&mipi_cmds_afr480360a0>;
+		aliasp = <&pinctrl_mipi_afr480360a0>;
+		delay-prepare = <150>;
+		mipi-cmds-enable = /bits/ 8 <
+			DELAY(120)
+			PAGE(3)
+			DCS_L5P(0xFF, 0x77, 0x01, 0x00, 0x00, 0x13)
+			DCS_S1P(0xEF, 0x08)
+			PAGE(1)
+			DCS_L5P(0xFF, 0x77, 0x01, 0x00, 0x00, 0x10)
+			DCS_L2P(0xC0, 0x2C, 0x00)
+			DCS_L2P(0xC1, 0x10, 0x0C)
+			DCS_L2P(0xC2, 0x21, 0x0A)
+			DCS_S1P(0xCC, 0x10)
+			0x11
+			  0xB0 0x00 0x12 0x9A 0x0E 0x12 0x07 0x0B 0x08 0x09 0x26 0x05 0x51 0x0F 0x69 0x30 0x1C
+			0x11
+			  0xB1 0x00 0x12 0x9B 0x0D 0x10 0x06 0x0B 0x09 0x08 0x25 0x03 0x50 0x0F 0x68 0x30 0x1C
+			PAGE(1)
+			DCS_L5P(0xFF, 0x77, 0x01, 0x00, 0x00, 0x11)
+			DCS_S1P(0xB0, 0x5D)
+			DCS_S1P(0xB1, 0x66)
+			DCS_S1P(0xB2, 0x84)
+			DCS_S1P(0xB3, 0x80)
+			DCS_S1P(0xB5, 0x4E)
+			DCS_S1P(0xB7, 0x85)
+			DCS_S1P(0xB8, 0x20)
+			DCS_S1P(0xC1, 0x78)
+			DCS_S1P(0xC2, 0x78)
+			DCS_S1P(0xD0, 0x88)
+			DCS_L3P(0xE0, 0x00, 0x00, 0x02)
+			0x0C
+			  0xE1 0x06 0xA0 0x08 0xA0 0x05 0xA0 0x07 0xA0 0x00 0x44 0x44
+			0x0D
+			  0xE2 0x00 0x00 0x44 0x44 0x01 0xA0 0x00 0x00 0x01 0xA0 0x00 0x00
+			DCS_L4P(0xE3, 0x00, 0x00, 0x11, 0x11)
+			DCS_L2P(0xE4, 0x44, 0x44)
+			0x11
+			  0xE5 0x0D 0x79 0x0A 0xA0 0x0F 0x7B 0x0A 0xA0 0x09 0x75 0x0A 0xA0 0x0B 0x77 0x0A 0xA0
+			DCS_L4P(0xE6, 0x00, 0x00, 0x11, 0x11)
+			DCS_L2P(0xE7, 0x44, 0x44)
+			0x11
+			  0xE8 0x0C 0x78 0x0A 0xA0 0x0E 0x7A 0x0A 0xA0 0x08 0x74 0x0A 0xA0 0x0A 0x76 0x0A 0xA0
+			DCS_L2P(0xE9, 0x36, 0x00)
+			0x08
+			  0xEB 0x00 0x01 0xE4 0xE4 0x44 0x80 0x40
+			0x11
+			  0xED 0xFF 0x45 0x67 0xFA 0x01 0x2B 0xAB 0xFF 0xFF 0xBA 0xB2 0x10 0xAF 0x76 0x54 0xFF
+			0x07
+			  0xEF 0x10 0x0D 0x04 0x08 0x3F 0x1F
+			DCS_L5P(0xFF, 0x77, 0x01, 0x00, 0x00, 0x00)
+			DCS_L5P(0xFF, 0x77, 0x01, 0x00, 0x00, 0x13)
+			DCS_L2P(0xE8, 0x00, 0x0E)
+			DCS_S0P(0x11)
+			DELAY(120)
+			DCS_L2P(0xE8, 0x00, 0x0C)
+			DELAY(10)
+			DCS_L2P(0xE8, 0x00,0x00)
+			DCS_L5P(0xFF, 0x77, 0x01, 0x00, 0x00, 0x00)
+			DCS_S1P(0x3A, 0x70)
+			DCS_S0P(0x29)
+			DELAY(20)
+			/* Exit Sleep */
+			DCS_S0P(0x11)
+			DELAY(120)
+			DCS_S0P(0x29)
+		>;
+		mipi-cmds-disable = /bits/ 8 <
+			DCS_S0P(0x28)		/* MIPI_DCS_SET_DISPLAY_OFF */
+			DELAY(20)
+			DCS_S0P(0x10)		/* Enter sleep */
+		>;
+		mipi-delay-between-cmds = <1>;
+		mode-video-hbp-disable;
+		mode-video-hfp-disable;
+		mode-video-hsa-disable;
+	};
+};
